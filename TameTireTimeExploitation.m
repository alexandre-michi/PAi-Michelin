close all;
clear all;
addpath('.\functions');

t = 1;
c = 18;

%% 1ere méthode

for m = 1:20

%% Chargement et mise en forme des données
% Initialisation des données
[T, tire_title, simulationInfo] = mesureInit(t,c,m);

% Estimation de la loi
T = T(1:end-1);
if exist('Loi')
    [temps, freq] = estimationLoi(T);
else
    [temps, freq, Loi, M] = estimationLoi(T);
end

% On contrôle que les 3 vecteurs soient de la même taille
if length(temps') ~= length(Loi')
    ind_end = length(Loi);
    if ind_end < length(temps)
        temps = temps(1:ind_end);
        freq = freq(1:ind_end);
    else
        temps = [temps, zeros(1,abs(length(temps) - ind_end))];
        freq = [freq, zeros(1,abs(length(freq) - ind_end))];
    end
end

% Affichage
% figure
% plot(temps,Loi,'r'); hold on
% plot(temps,freq,'b')
% legend('Loi', 'Données expérimentales');

%% Tests d'ajustements

% Corrélation
R = cov(Loi,freq).^2/(var(Loi).*var(freq));
R2(m) = R(1,1);

end

figure
plot(R2);
xlabel('itération');
ylabel('R2');
saveTestCorrelation(t,c,R2,tire_title,simulationInfo);

%% 2e méthode

% for m = 1:20
% 
% %% Chargement et mise en forme des données
% % Initialisation des données
% [T, tire_title, simulationInfo] = mesureInit(t,c,m);
% 
% % Estimation de la loi
% T = T(1:end-1);
% 
% [temps, freq, Loi, M(m)] = estimationLoi(T);
% 
% % Affichage
% % figure
% % plot(temps,Loi,'r'); hold on
% % plot(temps,freq,'b')
% % legend('Loi', 'Données expérimentales');
% 
% end
% 
% Mmoy = mean(M);
% Loi = Mmoy * exp(-Mmoy * temps);
% 
% % Tests d'ajustements
% for m=1:20
% [T, tire_title, simulationInfo] = mesureInit(t,c,m);
% T = T(1:end-1);
% [temps, freq] = estimationLoi(T);
% 
% % On contrôle que les 3 vecteurs soient de la même taille
% if length(temps') ~= length(Loi')
%     ind_end = length(Loi);
%     if ind_end < length(temps)
%         temps = temps(1:ind_end);
%         freq = freq(1:ind_end);
%     else
%         temps = [temps, zeros(1,abs(length(temps) - ind_end))];
%         freq = [freq, zeros(1,abs(length(freq) - ind_end))];
%     end
% end
% 
% % Corrélation
% Rbis = cov(Loi,freq).^2/(var(Loi).*var(freq));
% R2bis(m) = Rbis(1,1);
% end
% 
% figure
% plot(R2bis);
% xlabel('itération');
% ylabel('R2');

